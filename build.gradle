plugins {
    id "de.undercouch.download" version "3.4.3"
    id 'com.palantir.docker' version '0.22.0'
}

ext {
    javaVersion = "11"
    apmVersion = "1.6.0"
}

task download(type: Download) {
    src "https://search.maven.org/remotecontent?filepath=co/elastic/apm/elastic-apm-agent/${apmVersion}/elastic-apm-agent-${apmVersion}.jar"
    dest buildDir
    onlyIfModified true
}

docker {
    name 'mrjeffapp/openjdk-jre-apm'
    tags 'latest', "${javaVersion}", "${javaVersion}-${apmVersion}"
    buildArgs([BASE_IMAGE: "openjdk:${javaVersion}-jre-slim", 'APM_VERSION': "${apmVersion}"])
    files "$buildDir/elastic-apm-agent-${apmVersion}.jar"
    pull true
    noCache true
}
